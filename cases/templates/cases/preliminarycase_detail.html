{% extends "cases/base.html" %}
{% load cases_tags %}
{% load render_table from django_tables2 %}
{% load crispy_forms_tags %}
{% load django_import_data_tags %}

{% block content %}
{% make_breadcrumb preliminarycase %}
{% include "cases/base_detail_header.html" %}

<h1>Preliminary Case {{ preliminarycase.case_num }}</h1>
{% include "cases/base_detail.html" %}

<h2>Applicant Info</h2>
<table class="table">
    <tr>
        <th>Applicant</th>
        <td>
            {% if preliminarycase.applicant %}
            <a href={% url "person_detail" preliminarycase.applicant.id %}>{{ preliminarycase.applicant.name }}</a>
            {% else %}
            <p>None</p>
            {% endif %}
        </td>
    </tr>
    <tr>
        <th>Contact</th>
        <td>
            {% if preliminarycase.contact %}
            <a href={% url "person_detail" preliminarycase.contact.id %}>{{ preliminarycase.contact.name }}</a>
            {% else %}
            <p>None</p>
            {% endif %}
        </td>
    </tr>
</table>

<div class="row">
    <div class="col-sm">
        {% info_table preliminarycase "Application" application_info %}
    </div>
    <div class="col-sm">
        {% info_table preliminarycase "Status Info" status_info %}
    </div>
</div>

<h2>Related Case</h2>
{% if preliminarycase.pcase_group.case %}
<a href="{% url "case_detail" preliminarycase.pcase_group.case.case_num %}">{{ preliminarycase.pcase_group.case }}</a>
{% else %}
<p>No related Case</p>
{% endif %}

<h2>Related PCases</h2>
{% if preliminarycase.pcase_group.prelim_cases.exists %}
<ul>
    {% for pc in preliminarycase.pcase_group.prelim_cases.all %}
    <li>
        <a href="{% url "prelim_case_detail" pc.case_num %}">{{ pc }}</a>
    </li>
    {% endfor %}
</ul>
{% else %}
<p>No related PCases</p>
{% endif %}

<h2>Preliminary Facilities</h2>
{% if preliminarycase.pfacilities.all %}
<div class="container-fluid" style="border:1px solid #D3D3D3; border-radius: 10px">
    {% if pfacility_filter %}
    {% crispy pfacility_filter.form %}
    <button class="btn btn-info btn-sm filter-button" type="button" data-toggle="collapse" data-target="#facility-filter-form" aria-expanded="true" aria-controls="facility-filter-form">
        Show Filters
    </button>
    <p>{{ pfacility_table.data|length }} facilities</p>
    {% endif %}
    <form method="get" action={% url 'letters' %}>
        {% render_table pfacility_table %}
    </form>

</div>
{% else %}
<p>No Preliminary Facilities</p>
{% endif %}

<h2>Comments</h2>
{% if preliminarycase.comments %}
{{ preliminarycase.comments | linebreaks}}
{% else %}
<p>No comments</p>
{% endif %}



<h2>Attachments</h2>
{% if attachment_table.data %}
<div class="container-fluid">
    {% filter_table attachment_table attachment_filter %}
</div>
{% else %}
<p>No attachments</p>
{% endif %}

{% endblock %}
